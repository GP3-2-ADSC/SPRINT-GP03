<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/cadastro.css">
    <link rel="shortcut icon" href="./assets/favicon.ico" type="image/x-icon">
    <script src="./js/funcoes.js"></script>

    <title>Retria | Cadastro</title>
</head>

<body onload="sessionStorage.clear()">
    <div class="header-background">
        <div id="header" class="header-container row">
            <a href="./index.html"><img class="logo-header" src="./assets/testelogoSprint copiar.png"
                    alt="Logo azul da Retria" width="140px"></a>

            <div class="navbar">
                <ul>
                    <li><a href="./index.html" class="link">Início</a></li>
                    <li><a href="./index.html#servicos" class="link">Serviços</a></li>
                    <li><a href="./cadastro.html" class="link">Cadastro</a></li>
                    <li><a href="./login.html" class="link">Login</a></li>
                </ul>
            </div>
            <span class="menu" onclick="openClose(1)">&#9776;</span>
        </div>
    </div>

    <div id="myNav" class="overlay">
        <a href="javascript:void(0)" class="closebtn " onclick="openClose(0)">&times;</a>
        <div class="overlay-content">
            <a href="./index.html">Início</a>
            <a href="./index.html#servicos">Serviços</a>
            <a href="./cadastro.html">Cadastro</a>
            <a href="./login.html">Login</a>
        </div>
    </div>

    <div class="background center">
        <div class="container">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>

            <div class="caixa-formulario" id="caixaFormulario">
                <div class="campo">
                    <h2>Junte-se a nós</h2>
                    <h4>Faça o cadastro e tenha acesso a todas as inovações para seu negócio</h4>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_empresa">
                        <label class="user-label">Empresa</label>
                        <span class="span-required" id="span-empresa">É necessário inserir um nome</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_cnpj">
                        <label class="user-label">CPNJ</label>
                        <span class="span-required" id="span-cnpj">Necessário CNPJ com 14 dígitos</span>
                    </div>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_telefone_1">
                        <label class="user-label">Celular/Telefone (1)</label>
                        <span class="span-required" id="span-telefone1">Necessário telefone com 11 dígitos</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_telefone_2">
                        <label class="user-label">Celular/Telefone (2)</label>
                        <span class="span-required" id="span-telefone2">Necessário telefone com 11 dígitos</span>
                    </div>
                </div>

                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_resp">
                        <label class="user-label">Responsável</label>
                        <span class="span-required" id="span-resp">É necessário inserir um nome</span>
                    </div>
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_email">
                        <label class="user-label">E-mail do responsável</label>
                        <span class="span-required" id="span-email">Necessário inserir um e-mail válido</span>
                    </div>
                </div>

                <div class="ponto">
                    <span class="dot" style="background-color:#8cccf0;"></span>
                    <span class="dot"></span>
                </div>
                <button class="button" id="passarpag" onclick="nextPage(1)">Próximo</button>
            </div>
            <div id="div_aguardar" class="loading-div">
                <img src="./assets/loading_blue.gif" id="loading-gif">
            </div>

            <div id="div_erros_login">

            </div>
        </div>
    </div>
</body>

</html>
<script src="./js/transicao.js"></script>
<script src="./js/cadastro.js"></script>
<script src="./js/apiCEP.js"></script>

<script>
    let empresaStorage = [];
    let enderecoStorage = [];

    function getStorage() {
        console.log("Estou no storage da empresa!");
        console.log(empresaStorage);

        in_empresa.value = empresaStorage[0];
        in_cnpj.value = empresaStorage[1];
        in_telefone_1.value = empresaStorage[2];
        in_telefone_2.value = empresaStorage[3];
        in_email.value = empresaStorage[4];
        in_resp.value = empresaStorage[5];

    }

    function getStorageEnd() {
        console.log("Estou no storage do endereco!");
        console.log(empresaStorage);

        in_cep.value = enderecoStorage[0];
        in_logradouro.value = enderecoStorage[1];
        in_numero.value = enderecoStorage[2];
        in_bairro.value = enderecoStorage[3];
        in_cidade.value = enderecoStorage[4];
        in_complemento.value = enderecoStorage[5];
    }

    function nextPage(n) {
        const allInput = document.querySelectorAll('input');

        allInput.forEach(element => {
            element.classList.add('valido');
        });

        if (n == 1) {
            let nomeEmpresa = in_empresa.value;
            let cnpj = in_cnpj.value;
            let tel1 = in_telefone_1.value;
            let tel2 = in_telefone_2.value;
            let email = in_email.value;
            let resp = in_resp.value;

            empresaStorage.push(nomeEmpresa);
            empresaStorage.push(cnpj);
            empresaStorage.push(tel1);
            empresaStorage.push(tel2);
            empresaStorage.push(email);
            empresaStorage.push(resp);

            const cnpjRegex = /^\b\d{14}\b$/

            const telefoneRegex = /^\b\d{11}\b$/;

            const emailPadrao = /\S+@\S+\.\S+/;

            let campoVazio = nomeEmpresa == "" || cnpj == "" || tel1 == "" || email == "" || resp == "";

            if (campoVazio) {
                cardErro.style.display = "flex"
                mensagem_erro.innerHTML = "É necessário preencher todos os campos.";

                finalizarAguardar();
                setInterval(sumirMensagem, 5000);
                return false;
            }
            else {
                let error = []
                if (!cnpjRegex.test(cnpj)) {
                    console.log("CNPJ Incorreto")
                    document.getElementById("span-cnpj").style.display = "block";

                    const ipt_cnpj = document.querySelector('#in_cnpj');
                    ipt_cnpj.classList.remove('valido');
                    ipt_cnpj.classList.add('invalido');


                    error.push(document.getElementById("span-cnpj"));
                } else {
                    document.getElementById("span-cnpj").style.display = "none";

                    const ipt_cnpj = document.querySelector('#in_cnpj');
                    ipt_cnpj.classList.add('valido');
                    ipt_cnpj.classList.remove('invalido');
                }

                if (!telefoneRegex.test(tel1)) {
                    console.log("Telefone Incorreto")
                    document.getElementById("span-telefone1").style.display = "block";

                    const ipt_tel1 = document.querySelector('#in_telefone_1');
                    ipt_tel1.classList.remove('valido');
                    ipt_tel1.classList.add('invalido');

                    error.push(document.getElementById("span-telefone1"));
                } else {
                    document.getElementById("span-telefone1").style.display = "none";

                    const ipt_tel1 = document.querySelector('#in_telefone_1');
                    ipt_tel1.classList.add('valido');
                    ipt_tel1.classList.remove('invalido');

                }

                if (!emailPadrao.test(email)) {
                    console.log("Email Incorreto");
                    document.getElementById("span-email").style.display = "block";

                    const ipt_span_email = document.querySelector('#in_email');
                    ipt_span_email.classList.remove('valido');
                    ipt_span_email.classList.add('invalido');

                    error.push(document.getElementById("span-email"));
                } else {
                    document.getElementById("span-email").style.display = "none";

                    const ipt_span_email = document.querySelector('#in_email');
                    ipt_span_email.classList.add('valido');
                    ipt_span_email.classList.remove('invalido');
                }

                if (error.length > 0) {
                    return false;
                } else {
                    plotarNovaPagina();
                }

            }
        } else {
            caixaFormulario.innerHTML = ``;
            caixaFormulario.innerHTML = `
            <div class="campo">
                    <h2>Junte-se a nós</h2>
                    <h4>Faça o cadastro e tenha acesso a todas as inovações para seu negócio</h4>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_empresa">
                        <label class="user-label">Empresa</label>
                        <span class="span-required" id="span-empresa">É necessário inserir um nome</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_cnpj">
                        <label class="user-label">CPNJ</label>
                        <span class="span-required" id="span-cnpj">Necessário CNPJ com 14 dígitos</span>
                    </div>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_telefone_1">
                        <label class="user-label">Celular/Telefone (1)</label>
                        <span class="span-required" id="span-telefone1">Necessário telefone com 11 dígitos</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_telefone_2">
                        <label class="user-label">Celular/Telefone (2)</label>
                        <span class="span-required" id="span-telefone2">Necessário telefone com 11 dígitos</span>
                    </div>
                </div>

                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_resp">
                        <label class="user-label">Responsável</label>
                        <span class="span-required" id="span-resp">É necessário inserir um nome</span>
                    </div>
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_email">
                        <label class="user-label">Email do responsável</label>
                        <span class="span-required" id="span-email">Necessário inserir um e-mail válido</span>
                    </div>
                </div>

                <div class="ponto">
                    <span class="dot" style="background-color:#8cccf0;"></span>
                    <span class="dot"></span>
                </div>
                <button class="button" onclick="nextPage(1)">Próximo</button>
            `;
            getStorage();
        }

    }

    function plotarNovaPagina() {
        caixaFormulario.innerHTML = "";
        caixaFormulario.innerHTML = `

        <div class="campo">
                    <h2>Junte-se a nós</h2>
                    <h4>Finalize o cadastro e obtenha acesso a sua tela de monitoramento</h4>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" onkeyup="pegarEndereco()" type="text" name="text" autocomplete="off" class="input" id="in_cep">
                        <label class="user-label">CEP</label>
                        <span class="span-required">Campo inválido</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_logradouro">
                        <label class="user-label">Logradouro</label>
                        <span class="span-required">Campo inválido</span>
                    </div>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_numero">
                        <label class="user-label">Numero</label>
                        <span class="span-required">Campo inválido</span>
                    </div>

                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_bairro">
                        <label class="user-label">Bairro</label>
                        <span class="span-required">Campo inválido</span>
                    </div>
                </div>

                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_cidade">
                        <label class="user-label">Cidade</label>
                        <span class="span-required">Campo inválido</span>
                    </div>
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_estado">
                        <label class="user-label">Estado</label>
                        <span class="span-required">Campo inválido</span>
                    </div>
                </div>
                <div class="linha">
                    <div class="campo">
                        <input required="" type="text" name="text" autocomplete="off" class="input" id="in_complemento">
                        <label class="user-label">Complemento</label>
                        <span class="span-required">Campo inválido</span>
                    </div>
                </div>

                <div class="ponto">
                    <span class="dot"></span>
                    <span class="dot" style="background-color:#8cccf0;"></span>
                </div>

                <div class="linha">
                    <button class="button" onclick="nextPage(2)">Voltar</button>
                    <button class="buttonLogin" onclick = "cadastrarDados()">Cadastrar</button>
                </div>
           `
    }

    function cadastrarDados() {
        cadastrar(empresaStorage);
    }

</script>